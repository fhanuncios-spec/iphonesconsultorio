<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de iPhones</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, Arial;
  background: #f2f2f7;
  padding: 12px;
}

/* ===== TOPO ===== */
.header {
  background: #0f172a;
  color: #fff;
  padding: 14px;
  border-radius: 14px;
  margin-bottom: 12px;
  text-align: center;
}

.header .resumo-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-top: 10px;
}

.header .box {
  background: #1e293b;
  padding: 10px;
  border-radius: 10px;
  font-size: 13px;
}

/* ===== FILTROS ===== */
.filtros {
  background: #fff;
  padding: 12px;
  border-radius: 14px;
  margin-bottom: 12px;
}

select, input {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border-radius: 8px;
  border: 1px solid #ddd;
}

/* ===== LISTA ===== */
#lista {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

@media (max-width: 380px) {
  #lista {
    grid-template-columns: 1fr;
  }
}

/* ===== CARD ===== */
.card {
  background: #fff;
  border-radius: 14px;
  padding: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
}

.card h3 {
  margin: 0 0 6px 0;
  font-size: 14px;
}

.tags {
  font-size: 11px;
  margin-bottom: 6px;
}

.tag {
  padding: 4px 6px;
  border-radius: 6px;
  font-weight: bold;
}

.entrada { background: #e0f2fe; color: #0369a1; }
.vendido { background: #dcfce7; color: #166534; }
.nao { background: #fee2e2; color: #991b1b; }

.info {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
  font-size: 12px;
}

.info div {
  background: #f7f7f7;
  padding: 6px;
  border-radius: 6px;
}

.lucro {
  margin-top: 8px;
  padding: 8px;
  border-radius: 10px;
  background: #16a34a;
  color: #ffffff;
  font-weight: bold;
  text-align: center;
  font-size: 13px;
}

.comissao {
  margin-top: 6px;
  padding: 6px;
  border-radius: 8px;
  background: #ecfdf3;
  color: #065f46;
  font-weight: bold;
  text-align: center;
  font-size: 12px;
}
</style>
</head>

<body>

<div class="header">
  <h3 id="lucroMes">üí∞ Lucro total do m√™s: R$ 0</h3>

  <div class="resumo-grid">
    <div class="box" id="totalGeral">Total: 0</div>
    <div class="box" id="totalVendidos">Vendidos: 0</div>
    <div class="box" id="totalDisponiveis">Dispon√≠veis: 0</div>
  </div>
</div>

<div class="filtros">
  <select id="vendedor"></select>

  <select id="status">
    <option value="">Todos</option>
    <option value="SIM">Somente vendidos</option>
    <option value="NAO">Somente dispon√≠veis</option>
  </select>

  <input type="month" id="mes">
</div>

<div id="lista"></div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbwuroYkA_84ft4-fCOheB7_euWSHZrNuPlX_mZA97zekM2KAAss-7LCGhPhL401SQ2E/exec";
let dados = [];

fetch(URL)
  .then(r => r.json())
  .then(r => {
    dados = r;
    carregarVendedores();
    render();
  });

document.getElementById("vendedor").onchange = render;
document.getElementById("mes").onchange = render;
document.getElementById("status").onchange = render;

function carregarVendedores() {
  const select = document.getElementById("vendedor");
  const vendedores = [...new Set(dados.slice(1).map(l => l[1]).filter(Boolean))];

  select.innerHTML = `<option value="">Todos vendedores</option>`;
  vendedores.forEach(v => {
    select.innerHTML += `<option value="${v}">${v}</option>`;
  });
}

function render() {
  const lista = document.getElementById("lista");
  const vendedorFiltro = document.getElementById("vendedor").value;
  const mesFiltro = document.getElementById("mes").value;
  const statusFiltro = document.getElementById("status").value;

  lista.innerHTML = "";

  let lucroTotalMes = 0;
  let total = 0;
  let vendidos = 0;
  let disponiveis = 0;

  dados.slice(1).forEach(l => {
    const vendedor = l[1];

    // üî• QUALQUER COISA DIFERENTE DE "SIM" √â DISPON√çVEL
    const vendido = (l[11] || "").toUpperCase() === "SIM" ? "SIM" : "NAO";

    if (vendedorFiltro && vendedorFiltro !== vendedor) return;
    if (statusFiltro === "SIM" && vendido !== "SIM") return;
    if (statusFiltro === "NAO" && vendido === "SIM") return;

    total++;
    vendido === "SIM" ? vendidos++ : disponiveis++;

    const valorEntrada = Number(l[8]) || 0;
    const custoReparo = Number(l[9]) || 0;
    const valorVenda = Number(l[10]) || 0;
    const custosAdicionais = Number(l[13]) || 0;
    const comissao = Number(l[15]) || 0;

    const lucro = valorVenda - valorEntrada - custoReparo - custosAdicionais;

    if (vendido === "SIM" && mesFiltro) {
      lucroTotalMes += lucro;
    }

    lista.innerHTML += `
      <div class="card">
        <h3>üì± ${l[4]} ‚Ä¢ ${l[5]}</h3>

        <div class="tags">
          <span class="tag entrada">${l[3]}</span>
          <span class="tag ${vendido === "SIM" ? "vendido" : "nao"}">${vendido}</span>
        </div>

        <div class="info">
          <div><b>Cliente:</b> ${l[2]}</div>
          <div><b>Bateria:</b> ${l[7]}%</div>
          <div><b>Pago:</b> R$ ${valorEntrada}</div>
          <div><b>Venda:</b> R$ ${valorVenda}</div>
          <div><b>Reparo:</b> R$ ${custoReparo}</div>
          <div><b>Custos +:</b> R$ ${custosAdicionais}</div>
        </div>

        <div class="lucro">üí∞ R$ ${lucro}</div>

        ${comissao > 0 ? `<div class="comissao">Comiss√£o: R$ ${comissao}</div>` : ""}
      </div>
    `;
  });

  document.getElementById("lucroMes").innerText =
    mesFiltro ? `üí∞ Lucro total do m√™s: R$ ${lucroTotalMes}` : "üí∞ Selecione um m√™s";

  document.getElementById("totalGeral").innerText = `Total: ${total}`;
  document.getElementById("totalVendidos").innerText = `Vendidos: ${vendidos}`;
  document.getElementById("totalDisponiveis").innerText = `Dispon√≠veis: ${disponiveis}`;
}
</script>

</body>
</html>
